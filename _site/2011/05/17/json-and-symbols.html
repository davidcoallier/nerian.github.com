<!DOCTYPE HTML>
<html>
    <head>
        <meta http-equiv="Content-type" content="text/html; charset=utf-8">
		<meta content='Freelance Web Developer for Ruby' name='description' /> 
	    <meta content='gonzalo rodriguez-baltanas diaz, ruby, freelance, mongodb' name='keywords' />
        <title>Nerian Blog: Did you know that JSON.encode doesn't respect symbols?</title>
        <link rel="stylesheet" href="/css/master.css">
		<link rel="stylesheet" href="/css/coderay.css">
    </head>
    <body>        
	
		<div id="wrapper">          
	<div id="header">       	   
		<div id='actions'>
			<ul>
				<li><a href="/index.html">Blog</a></li>
				<li><a href="/about.html">Hire me</a></li>
				<li>
					<a href="http://feeds.feedburner.com/Nerian-blog" 
					target='_blank' 
					type="application/rss+xml">					
					Subscribe</a>
				</li>				
			</ul>
		</div>		                                                                     
	</div>                                                 	
	<div id="content">                                     
		<div class='post'>
			<div>
	<h2><a href="/2011/05/17/json-and-symbols.html">Did you know that JSON.encode doesn't respect symbols?</a></h2>
	<br/>
	<div>
		<p>Today was one of those days that instead of addressing myself as a programmer I entitle myself the title of ‘Bug Exorcist’.</p>

<p>Doing bug exorcism is a very dangerous matter. Do not take it lightly for it can be your doom. The job of a Bug Exorcist is to track down devilish bugs that disguise themselves in the most elaborate ways. I will elaborate on one in particular:</p>

<div><div class="CodeRay">
  <div class="code"><pre>ruby-<span class="float">1.9</span>.<span class="error">2</span>-p180 :<span class="integer">086</span> &gt; require <span class="string"><span class="delimiter">'</span><span class="content">json</span><span class="delimiter">'</span></span>    
                 
<span class="comment"># A hash that contains a string key. </span>
ruby-<span class="float">1.9</span>.<span class="error">2</span>-p180 :<span class="integer">065</span> &gt; arra = {<span class="string"><span class="delimiter">'</span><span class="content">cu</span><span class="delimiter">'</span></span>=&gt;<span class="string"><span class="delimiter">'</span><span class="content">algo</span><span class="delimiter">'</span></span>}
 =&gt; {<span class="string"><span class="delimiter">&quot;</span><span class="content">cu</span><span class="delimiter">&quot;</span></span>=&gt;<span class="string"><span class="delimiter">&quot;</span><span class="content">algo</span><span class="delimiter">&quot;</span></span>}
<span class="comment"># A hash that contains a symbol key.</span>
ruby-<span class="float">1.9</span>.<span class="error">2</span>-p180 :<span class="integer">066</span> &gt; arra2 = {cu: <span class="string"><span class="delimiter">'</span><span class="content">algo</span><span class="delimiter">'</span></span>}
 =&gt; {<span class="symbol">:cu</span>=&gt;<span class="string"><span class="delimiter">&quot;</span><span class="content">algo</span><span class="delimiter">&quot;</span></span>}              
<span class="comment"># You would say they are different, won't you?</span>
      
<span class="comment"># Are you watching closely?</span>
ruby-<span class="float">1.9</span>.<span class="error">2</span>-p180 :<span class="integer">067</span> &gt; <span class="constant">JSON</span>.dump(arra)
 =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">{</span><span class="char">\&quot;</span><span class="content">cu</span><span class="char">\&quot;</span><span class="content">:</span><span class="char">\&quot;</span><span class="content">algo</span><span class="char">\&quot;</span><span class="content">}</span><span class="delimiter">&quot;</span></span>
ruby-<span class="float">1.9</span>.<span class="error">2</span>-p180 :<span class="integer">080</span> &gt; <span class="constant">JSON</span>.dump(arra2)
 =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">{</span><span class="char">\&quot;</span><span class="content">cu</span><span class="char">\&quot;</span><span class="content">:</span><span class="char">\&quot;</span><span class="content">algo</span><span class="char">\&quot;</span><span class="content">}</span><span class="delimiter">&quot;</span></span>

ruby-<span class="float">1.9</span>.<span class="error">2</span>-p180 :<span class="integer">081</span> &gt; <span class="constant">JSON</span>.parse(<span class="constant">JSON</span>.dump(arra)) == arra
 =&gt; <span class="predefined-constant">true</span>
ruby-<span class="float">1.9</span>.<span class="error">2</span>-p180 :<span class="integer">082</span> &gt; <span class="constant">JSON</span>.parse(<span class="constant">JSON</span>.dump(arra2)) == arra
 =&gt; <span class="predefined-constant">true</span>
ruby-<span class="float">1.9</span>.<span class="error">2</span>-p180 :<span class="integer">086</span> &gt; <span class="constant">JSON</span>.parse(<span class="constant">JSON</span>.dump(arra2)) == arra2
 =&gt; <span class="predefined-constant">false</span>

<span class="constant">JSON</span>.parse(<span class="constant">JSON</span>.dump(arra1))
 =&gt; {<span class="string"><span class="delimiter">&quot;</span><span class="content">cu</span><span class="delimiter">&quot;</span></span>=&gt;<span class="string"><span class="delimiter">&quot;</span><span class="content">algo</span><span class="delimiter">&quot;</span></span>}        
<span class="constant">JSON</span>.parse(<span class="constant">JSON</span>.dump(arra2))
 =&gt; {<span class="string"><span class="delimiter">&quot;</span><span class="content">cu</span><span class="delimiter">&quot;</span></span>=&gt;<span class="string"><span class="delimiter">&quot;</span><span class="content">algo</span><span class="delimiter">&quot;</span></span>}
</pre></div>
</div>
</div>

<p>Pray with me:  I shall never use symbols when I use JSON.     </p>

<p>And another perl: </p>

<div><div class="CodeRay">
  <div class="code"><pre>ruby-<span class="float">1.9</span>.<span class="error">2</span>-p180 :<span class="integer">090</span> &gt; otro={<span class="integer">5</span>=&gt;<span class="string"><span class="delimiter">'</span><span class="content">algo</span><span class="delimiter">'</span></span>}
 =&gt; {<span class="integer">5</span>=&gt;<span class="string"><span class="delimiter">&quot;</span><span class="content">algo</span><span class="delimiter">&quot;</span></span>} 
ruby-<span class="float">1.9</span>.<span class="error">2</span>-p180 :<span class="integer">091</span> &gt; otro[<span class="integer">5</span>]
 =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">algo</span><span class="delimiter">&quot;</span></span> 
ruby-<span class="float">1.9</span>.<span class="error">2</span>-p180 :<span class="integer">092</span> &gt; <span class="constant">JSON</span>.parse(<span class="constant">JSON</span>.dump(otro))
 =&gt; {<span class="string"><span class="delimiter">&quot;</span><span class="content">5</span><span class="delimiter">&quot;</span></span>=&gt;<span class="string"><span class="delimiter">&quot;</span><span class="content">algo</span><span class="delimiter">&quot;</span></span>} 
ruby-<span class="float">1.9</span>.<span class="error">2</span>-p180 :<span class="integer">093</span> &gt; <span class="constant">JSON</span>.parse(<span class="constant">JSON</span>.dump(otro)) == otro
 =&gt; <span class="predefined-constant">false</span>     
</pre></div>
</div>
</div>

<p>Pray with me: Never use integers </p>

<p>Or any other object, for that matter:</p>

<div><div class="CodeRay">
  <div class="code"><pre>ruby-<span class="float">1.9</span>.<span class="error">2</span>-p180 :<span class="integer">096</span> &gt; persona = <span class="constant">Person</span>.new
 =&gt; <span class="comment">#&lt;Person:0x00000101883900&gt; </span>
ruby-<span class="float">1.9</span>.<span class="error">2</span>-p180 :<span class="integer">098</span> &gt; mas = {persona =&gt; <span class="string"><span class="delimiter">'</span><span class="content">jojo</span><span class="delimiter">'</span></span>}
 =&gt; {<span class="comment">#&lt;Person:0x00000101883900&gt;=&gt;&quot;jojo&quot;} </span>
ruby-<span class="float">1.9</span>.<span class="error">2</span>-p180 :<span class="integer">099</span> &gt; mas[persona]
 =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">jojo</span><span class="delimiter">&quot;</span></span> 

ruby-<span class="float">1.9</span>.<span class="error">2</span>-p180 :<span class="integer">101</span> &gt; <span class="constant">JSON</span>.parse(<span class="constant">JSON</span>.dump(mas)) == mas
 =&gt; <span class="predefined-constant">false</span> 
ruby-<span class="float">1.9</span>.<span class="error">2</span>-p180 :<span class="integer">102</span> &gt; <span class="constant">JSON</span>.parse(<span class="constant">JSON</span>.dump(mas)) 
 =&gt; {<span class="string"><span class="delimiter">&quot;</span><span class="content">#&lt;Person:0x00000101883900&gt;</span><span class="delimiter">&quot;</span></span>=&gt;<span class="string"><span class="delimiter">&quot;</span><span class="content">jojo</span><span class="delimiter">&quot;</span></span>}
</pre></div>
</div>
</div>

<p>Conclusion: In JSON keys are always just strings. Don’t get fancy with your keys :)</p>
	
		<br/>
    <br/>
    <em>Posted on 17 May 2011</em>	                              				
	</div>	                                              	
</div>

<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
	var disqus_shortname = 'nerian-blog';

    // The following are highly recommended additional parameters. Remove the slashes in front to use.
    // var disqus_identifier = 'unique_dynamic_id_1234';
    // var disqus_url = 'http://example.com/permalink-to-page.html';

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>                                                                                                  			
		</div>                                                                                                             				
	</div>
	<div id="footer">       	   
		<a href="/about.html">Hire a great web developer</a>
	</div>   	
</div>     
   		
		<script type="text/javascript">

		  var _gaq = _gaq || [];
		  _gaq.push(['_setAccount', 'UA-20768366-1']);
		  _gaq.push(['_trackPageview']);

		  (function() {
		    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
		    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
		    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		  })();

		</script>    	       				
    </body>  
</html>